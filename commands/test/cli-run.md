---
description: Run CLI test suites (interactive or automated)
arguments:
  - name: mode
    description: Execution mode (interactive|automated|auto)
    required: false
    default: auto
  - name: path
    description: Path to test suite
    required: false
  - name: dry-run
    description: Preview CLI test execution without running tests
    required: false
    default: false
    alias: -n
---

# /craft:test:cli-run - CLI Test Suite Runner

Execute CLI test suites generated by `/craft:test:cli-gen`.

## Purpose

Run CLI test suites with appropriate mode:
- **interactive** - Guided testing with human input
- **automated** - CI-ready execution (exit 0/1)
- **auto** - Auto-detect mode from test files

## Usage

```bash
/craft:test:cli-run                          # Auto-detect and run
/craft:test:cli-run interactive              # Run interactive mode
/craft:test:cli-run automated                # Run CI mode
/craft:test:cli-run automated --verbose      # Verbose output
/craft:test:cli-run --log test-results.log   # Log to file
/craft:test:cli-run --dry-run                # Preview test plan
/craft:test:cli-run automated -n             # Preview CI mode
```

## Dry-Run Mode

Preview CLI test execution plan:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” DRY RUN: CLI Test Execution                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚ âœ“ Test Suite Discovery:                                       â”‚
â”‚   - Search paths: tests/, tests/cli/                          â”‚
â”‚   - Patterns: *cli*.sh, *cli*.bats, *.tape                    â”‚
â”‚   - Found: 2 test suites                                      â”‚
â”‚                                                               â”‚
â”‚ âœ“ Test Suites:                                                â”‚
â”‚                                                               â”‚
â”‚   1. tests/cli/interactive-tests.sh                           â”‚
â”‚      Type: Interactive (manual testing)                       â”‚
â”‚      Tests: 8 scenarios                                       â”‚
â”‚      Format: Bash script with assertions                      â”‚
â”‚      Estimated: ~5 minutes (human-paced)                      â”‚
â”‚                                                               â”‚
â”‚   2. tests/cli/automated-tests.bats                           â”‚
â”‚      Type: Automated (CI-ready)                               â”‚
â”‚      Tests: 23 test cases                                     â”‚
â”‚      Format: BATS (Bash Automated Testing System)             â”‚
â”‚      Estimated: ~45 seconds                                   â”‚
â”‚                                                               â”‚
â”‚ âœ“ Mode Selection: auto                                        â”‚
â”‚   Strategy: Run automated first, skip interactive in CI       â”‚
â”‚                                                               â”‚
â”‚ âœ“ Execution Plan:                                             â”‚
â”‚   Phase 1: Automated Tests                                    â”‚
â”‚      Command: bats tests/cli/automated-tests.bats             â”‚
â”‚      Exit on failure: Yes                                     â”‚
â”‚                                                               â”‚
â”‚   Phase 2: Interactive Tests (skipped in non-TTY)             â”‚
â”‚      Command: bash tests/cli/interactive-tests.sh             â”‚
â”‚      Requires: Terminal with user input                       â”‚
â”‚                                                               â”‚
â”‚ âœ“ Output Format:                                              â”‚
â”‚   - TAP (Test Anything Protocol) from BATS                    â”‚
â”‚   - Human-readable progress from interactive                  â”‚
â”‚   - Exit code: 0 (all pass) or 1 (any fail)                  â”‚
â”‚                                                               â”‚
â”‚ âš  Notes:                                                      â”‚
â”‚   â€¢ Interactive tests skipped in CI (no TTY)                  â”‚
â”‚   â€¢ Use 'automated' mode to skip interactive tests            â”‚
â”‚   â€¢ Use 'interactive' mode to run only interactive tests      â”‚
â”‚                                                               â”‚
â”‚ ğŸ“Š Summary: 2 suites, 31 tests total, ~45s automated          â”‚
â”‚                                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Run without --dry-run to execute                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Note**: Dry-run shows the CLI test execution plan without running actual tests. Use this to verify test discovery and understand which tests will run.

## Step-by-Step Process

### Step 1: Locate Test Suites

```bash
# Find CLI test files
find tests -name "*cli*.sh" -o -name "*cli*.bats" 2>/dev/null
ls tests/cli/ 2>/dev/null
```

**Detection:**
```
ğŸ” CLI TEST SUITES DETECTED
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Found test suites:
  ğŸ“„ tests/cli/interactive-tests.sh (interactive)
  ğŸ“„ tests/cli/automated-tests.sh (automated)

Select mode:
  1. [interactive] Run interactive test suite
  2. [automated]   Run automated test suite (CI mode)
  3. [both]        Run both sequentially

Or: /craft:test:cli-run <mode>
```

### Step 2: Execute Tests

#### Interactive Mode

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  INTERACTIVE CLI TEST SUITE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Starting interactive test session...
Press Ctrl+C to abort at any time.

â–¶ TEST 1/15: Version Check
  Command: aiterm --version
  Expected: Version string

Run test? (y/n/skip) y

aiterm v0.3.0

Did this match expected? (y/n) y
âœ… PASS

â–¶ TEST 2/15: Doctor Check
  Command: aiterm doctor
  Expected: System diagnostics

Run test? (y/n/skip) y
...
```

#### Automated Mode

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  AUTOMATED CLI TEST SUITE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Running automated tests...

[1/15] CLI is installed ............................ âœ… PASS
[2/15] Version command works ...................... âœ… PASS
[3/15] Help is accessible ......................... âœ… PASS
[4/15] Doctor command completes ................... âœ… PASS
[5/15] Detect returns context info ................ âœ… PASS
[6/15] Invalid commands handled gracefully ........ âœ… PASS
[7/15] Claude settings accessible ................. âœ… PASS
[8/15] MCP list works ............................. âœ… PASS
[9/15] Sessions live works ........................ âœ… PASS
[10/15] IDE list works ............................ âœ… PASS
[11/15] OpenCode config works ..................... âœ… PASS
[12/15] Exit code 0 on success .................... âœ… PASS
[13/15] Exit code 1 on error ...................... âœ… PASS
[14/15] Verbose flag works ........................ âœ… PASS
[15/15] Output format correct ..................... âœ… PASS

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  RESULTS: 15 passed, 0 failed, 0 skipped
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Time: 23.4s
Exit: 0
```

### Step 3: Generate Report

```
ğŸ“Š CLI TEST REPORT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Suite: tests/cli/automated-tests.sh
Date: 2025-12-26 19:30:00
Duration: 23.4s

Results:
  âœ… Passed: 15 (100%)
  âŒ Failed: 0 (0%)
  â­ï¸ Skipped: 0 (0%)

Test Breakdown:
  Category      | Passed | Failed
  --------------|--------|-------
  Smoke         | 3      | 0
  Commands      | 8      | 0
  Arguments     | 2      | 0
  Errors        | 1      | 0
  Exit codes    | 1      | 0

Status: âœ… ALL TESTS PASSED
```

## Output Format

### Success Output

```
âœ… CLI TESTS PASSED
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Results: 15/15 tests passed (100%)
Time: 23.4s
Exit code: 0

CI status: PASS
```

### Failure Output

```
âŒ CLI TESTS FAILED
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Results: 13/15 tests passed (86.7%)
Time: 31.2s
Exit code: 1

Failed tests:
  âŒ [8/15] MCP list works
     Expected: Server list output
     Actual: Error - config not found

  âŒ [11/15] OpenCode config works
     Expected: Config display
     Actual: Command not recognized

Debug: Run with --verbose for details
CI status: FAIL
```

## Options

| Option | Description | Example |
|--------|-------------|---------|
| `--verbose` | Detailed output | Show command stdout/stderr |
| `--log <file>` | Log to file | `--log results.log` |
| `--timeout <s>` | Per-test timeout | `--timeout 30` |
| `--bail` | Stop on first failure | For quick feedback |
| `--report <fmt>` | Output format | `json`, `junit`, `tap` |

## CI Integration

### GitHub Actions

```yaml
- name: Run CLI Tests
  run: |
    /craft:test:cli-run automated --report junit > test-results.xml

- name: Upload Test Results
  uses: actions/upload-artifact@v3
  with:
    name: cli-test-results
    path: test-results.xml
```

### Generic CI

```bash
# Run tests with CI-friendly output
bash tests/cli/automated-tests.sh

# Check exit code
if [ $? -eq 0 ]; then
    echo "CLI tests passed"
else
    echo "CLI tests failed"
    exit 1
fi
```

## Exit Codes

| Code | Meaning |
|------|---------|
| `0` | All tests passed |
| `1` | One or more tests failed |
| `2` | Test suite error (config, syntax) |

## Integration

Works with:
- `/craft:test:cli-gen` - Generate test suites
- `/craft:test:run` - Unified test runner
- `/craft:code:ci-local` - CI checks
- `/craft:git:sync` - Pre-commit test run
